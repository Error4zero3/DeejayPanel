/*
* MultiSelect v0.9.5
* Copyright (c) 2012 Louis Cuny
*
* This program is free software. It comes without any warranty, to
* the extent permitted by applicable law. You can redistribute it
* and/or modify it under the terms of the Do What The Fuck You Want
* To Public License, Version 2, as published by Sam Hocevar. See
* http://sam.zoy.org/wtfpl/COPYING for more details.
*/!function(e){"use strict";var t=function(t,n){this.options=n;this.$element=e(t);this.$container=e('<div id="ms-'+this.$element.attr("id")+'" class="ms-container"></div>');this.$selectableContainer=e('<div class="ms-selectable"></div>');this.$selectionContainer=e('<div class="ms-selection"></div>');this.$selectableUl=e('<ul class="ms-list"></ul>');this.$selectionUl=e('<ul class="ms-list"></ul>');this.scrollTo=0};t.prototype={constructor:t,init:function(){var t=this,n=this.$element;if(n.next(".ms-container").length==0){n.css({position:"absolute",left:"-9999px"});n.attr("id",n.attr("id")?n.attr("id"):"ms-"+Math.ceil(Math.random()*1e3));var r=null,i=null,s=0,o=0,u='<li class="ms-optgroup-container"></li>',a='<ul class="ms-optgroup"></ul>',f='<li class="ms-optgroup-label"><span></span></li>';n.find("optgroup, option").each(function(){if(e(this).is("optgroup")){r="<span>"+e(this).attr("label")+"</span>";i="ms-"+n.attr("id")+"-optgroup-"+s;var o=e(this),l=e(u),c=e(u),h=e(f),p=e(f);if(t.options.selectableOptgroup){p.on("click",function(){var n=o.children(":not(:selected)").map(function(){return e(this).val()}).get();t.select(n)});h.on("click",function(){var n=o.children(":selected").map(function(){return e(this).val()}).get();t.deselect(n)})}p.html(r);l.attr("id",i+"-selectable").append(e(a).append(p));t.$selectableUl.append(l);h.html(r);c.attr("id",i+"-selection").append(e(a).append(h));t.$selectionUl.append(c);s++}else{var d="";for(var v=0;v<this.attributes.length;v++){var m=this.attributes[v];t.isDomNode(m.name)&&(d+=m.name+'="'+m.value+'" ')}var g=e("<li "+d+"><span>"+e(this).text()+"</span></li>"),y=g.clone(),b=e(this).val(),w=t.sanitize(b);g.data("ms-value",b).addClass("ms-elem-selectable").attr("id",w+"-selectable");y.data("ms-value",b).addClass("ms-elem-selection").attr("id",w+"-selection").hide();t.$selectionUl.find(".ms-optgroup-label").hide();if(e(this).prop("disabled")||n.prop("disabled"))if(this.selected){y.prop("disabled",!0);y.addClass(t.options.disabledClass)}else{g.prop("disabled",!0);g.addClass(t.options.disabledClass)}if(i){t.$selectableUl.children("#"+i+"-selectable").find("ul").first().append(g);t.$selectionUl.children("#"+i+"-selection").find("ul").first().append(y)}else{t.$selectableUl.append(g);t.$selectionUl.append(y)}}});t.options.selectableHeader&&t.$selectableContainer.append(t.options.selectableHeader);t.$selectableContainer.append(t.$selectableUl);t.options.selectableFooter&&t.$selectableContainer.append(t.options.selectableFooter);t.options.selectionHeader&&t.$selectionContainer.append(t.options.selectionHeader);t.$selectionContainer.append(t.$selectionUl);t.options.selectionFooter&&t.$selectionContainer.append(t.options.selectionFooter);t.$container.append(t.$selectableContainer);t.$container.append(t.$selectionContainer);n.after(t.$container);t.$selectableUl.on("mouseenter",".ms-elem-selectable",function(){e("li",t.$container).removeClass("ms-hover");e(this).addClass("ms-hover")}).on("mouseleave",function(){e("li",t.$container).removeClass("ms-hover")});if(t.options.dblClick){t.$selectableUl.on("dblclick",".ms-elem-selectable",function(){t.select(e(this).data("ms-value"))});t.$selectionUl.on("dblclick",".ms-elem-selection",function(){t.deselect(e(this).data("ms-value"))})}else{t.$selectableUl.on("click",".ms-elem-selectable",function(){t.select(e(this).data("ms-value"))});t.$selectionUl.on("click",".ms-elem-selection",function(){t.deselect(e(this).data("ms-value"))})}t.$selectionUl.on("mouseenter",".ms-elem-selection",function(){e("li",t.$selectionUl).removeClass("ms-hover");e(this).addClass("ms-hover")}).on("mouseleave",function(){e("li",t.$selectionUl).removeClass("ms-hover")});t.$selectableUl.on("focusin",function(){e(this).addClass("ms-focus");t.$selectionUl.focusout()}).on("focusout",function(){e(this).removeClass("ms-focus");e("li",t.$container).removeClass("ms-hover")});t.$selectionUl.on("focusin",function(){e(this).addClass("ms-focus")}).on("focusout",function(){e(this).removeClass("ms-focus");e("li",t.$container).removeClass("ms-hover")});n.on("focusin",function(){n.focusout();t.$selectableUl.focusin()}).on("focusout",function(){t.$selectableUl.removeClass("ms-focus");t.$selectionUl.removeClass("ms-focus")});n.onKeyDown=function(e,n){var r=t.$container.find("."+n).find(".ms-list"),i=r.find("li:visible:not(.ms-optgroup-label, .ms-optgroup-container)"),s=i.length,o=r.find("li.ms-hover"),u=o.length>0?i.index(o):-1,a=r.innerHeight(),f=i.first().outerHeight(!0),l=Math.floor(a/f);if(e.keyCode==32){if(o.length>0){var c=n=="ms-selectable"?"select":"deselect";n=="ms-selectable"?t.select(o.data("ms-value")):t.deselect(o.data("ms-value"));i.removeClass("ms-hover");t.scrollTo=0;r.scrollTop(t.scrollTo)}}else if(e.keyCode==40){if(i.length>0){var h=u+1,p=s!=h?i.eq(h):i.first(),d=r.position().top,v=p.position().top;i.removeClass("ms-hover");p.addClass("ms-hover");s==h?t.scrollTo=0:v>=d+l*f&&(t.scrollTo+=f);r.scrollTop(t.scrollTo)}}else if(e.keyCode==38){if(i.length>0){var m=Math.max(u-1,-1),g=i.eq(m),d=r.position().top,y=g.position().top;i.removeClass("ms-hover");g.addClass("ms-hover");y<=d?t.scrollTo-=f:m<0&&(t.scrollTo=(s-l)*f);r.scrollTop(t.scrollTo)}}else if(e.keyCode==37||e.keyCode==39)if(t.$selectableUl.hasClass("ms-focus")){t.$selectableUl.focusout();t.$selectionUl.focusin()}else{t.$selectableUl.focusin();t.$selectionUl.focusout()}};n.on("keydown",function(e){if(n.is(":focus")){var r=t.$selectableUl.hasClass("ms-focus")?"ms-selectable":"ms-selection";n.onKeyDown(e,r)}})}var l=n.find("option:selected").map(function(){return e(this).val()}).get();t.select(l,"init");typeof t.options.afterInit=="function"&&t.options.afterInit.call(this,this.$container)},refresh:function(){e("#ms-"+this.$element.attr("id")).remove();this.init(this.options)},select:function(t,n){typeof t=="string"&&(t=[t]);var r=this,i=this.$element,s=e.map(t,function(e,t){return r.sanitize(e)}),o=this.$selectableUl.find("#"+s.join("-selectable, #")+"-selectable").filter(":not(."+r.options.disabledClass+")"),u=this.$selectionUl.find("#"+s.join("-selection, #")+"-selection"),a=i.find("option").filter(function(n){return e.inArray(this.value,t)>-1});if(o.length>0){o.addClass("ms-selected").hide();u.addClass("ms-selected").show();a.prop("selected",!0);var f=r.$selectableUl.children(".ms-optgroup-container");if(f.length>0){f.each(function(){var t=e(this).find(".ms-elem-selectable");t.length==t.filter(".ms-selected").length&&e(this).find(".ms-optgroup-label").hide()});var l=r.$selectionUl.children(".ms-optgroup-container");l.each(function(){var t=e(this).find(".ms-elem-selection");t.filter(".ms-selected").length>0&&e(this).find(".ms-optgroup-label").show()})}if(n!="init"){r.$selectionUl.focusout();r.$selectableUl.focusin();i.trigger("change");typeof r.options.afterSelect=="function"&&r.options.afterSelect.call(this,t)}}},deselect:function(t){typeof t=="string"&&(t=[t]);var n=this,r=this.$element,i=e.map(t,function(e,t){return n.sanitize(e)}),s=this.$selectableUl.find("#"+i.join("-selectable, #")+"-selectable"),o=this.$selectionUl.find("#"+i.join("-selection, #")+"-selection").filter(".ms-selected"),u=r.find("option").filter(function(n){return e.inArray(this.value,t)>-1});if(o.length>0){s.removeClass("ms-selected").show();o.removeClass("ms-selected").hide();u.prop("selected",!1);var a=n.$selectableUl.children(".ms-optgroup-container");if(a.length>0){a.each(function(){var t=e(this).find(".ms-elem-selectable");t.filter(":not(.ms-selected)").length>0&&e(this).find(".ms-optgroup-label").show()});var f=n.$selectionUl.children(".ms-optgroup-container");f.each(function(){var t=e(this).find(".ms-elem-selection");t.filter(".ms-selected").length==0&&e(this).find(".ms-optgroup-label").hide()})}this.$selectableUl.focusout();this.$selectionUl.focusin();r.trigger("change");typeof n.options.afterDeselect=="function"&&n.options.afterDeselect.call(this,t)}},select_all:function(){var t=this.$element,n=t.val();t.find("option").prop("selected",!0);this.$selectableUl.find(".ms-elem-selectable").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").addClass("ms-selected").show();this.$selectionUl.focusin();this.$selectableUl.focusout();t.trigger("change");if(typeof this.options.afterSelect=="function"){var r=e.grep(t.val(),function(t){return e.inArray(t,n)<0});this.options.afterSelect.call(this,r)}},deselect_all:function(){var e=this.$element,t=e.val();e.find("option").prop("selected",!1);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focusin();this.$selectionUl.focusout();e.trigger("change");typeof this.options.afterDeselect=="function"&&this.options.afterDeselect.call(this,t)},isDomNode:function(e){return e&&typeof e=="object"&&typeof e.nodeType=="number"&&typeof e.nodeName=="string"},sanitize:function(e){return e.replace(/[^A-Za-z0-9]*/gi,"_")}};e.fn.multiSelect=function(){var n=arguments[0],r=arguments;return this.each(function(){var i=e(this),s=i.data("multiselect"),o=e.extend({},e.fn.multiSelect.defaults,i.data(),typeof n=="object"&&n);s||i.data("multiselect",s=new t(this,o));typeof n=="string"?s[n](r[1]):s.init()})};e.fn.multiSelect.defaults={selectableOptgroup:!1,disabledClass:"disabled",dblClick:!1};e.fn.multiSelect.Constructor=t}(window.jQuery);